<!-- eslint-disable @angular-eslint/template/click-events-have-key-events -->
<!-- eslint-disable @angular-eslint/template/use-track-by-function -->
<ng-content select="[etInputPrefix]" />

<div class="et-combobox-wrapper">
  <ul *ngIf="multiple$ | async" class="et-combobox-selected-options">
    <li *ngFor="let item of selectedOptions$ | async" class="et-combobox-selected-option">
      <ng-container
        *ngIf="customSelectedOptionTpl$ | async as customSelectedOptionTpl; else defaultSelectedOptionLabelTpl"
      >
        <ng-container *ngTemplateOutlet="customSelectedOptionTpl; context: { option: item }" />
      </ng-container>

      <ng-template #defaultSelectedOptionLabelTpl>
        {{ getOptionLabel(item) | async }}
      </ng-template>

      <span
        (click)="removeSelectedOption(item); $event.stopPropagation()"
        class="et-combobox-selected-option-remove"
        tabindex="-1"
      >
        x
      </span>
    </li>
    <li class="et-combobox-muliple-input">
      <ng-container *ngTemplateOutlet="inputTpl" />
    </li>
  </ul>

  <ng-template #inputTpl>
    <input
      (keydown)="processKeydownEvent($event)"
      (click)="open()"
      (blur)="handleBlurEvent()"
      (input)="processInputEvent($event)"
      type="text"
      etNativeInputRef
    />
  </ng-template>

  <ng-container *ngIf="(multiple$ | async) === false">
    <ng-container *ngTemplateOutlet="inputTpl" />
  </ng-container>

  <et-chevron-icon class="et-combobox-chevron" />
</div>

<ng-content select="[etInputSuffix]" />

<ng-template>
  <ng-content />
</ng-template>
